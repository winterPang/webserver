{"version":3,"sources":["frame/component/modal/bs_modal.js"],"names":["directive","$rootScope","lang","animateInterval","DEFAULTS","mId","title","promptTitle","showHeader","showFooter","bodyHeight","undefined","bodyMaxHeight","modalSize","autoClose","showOk","showCancel","showClose","okText","promptBtnOkText","cancelText","promptBtnNoText","okHandler","$","noop","cancelHandler","beforeRender","strfmt","tpl","vars","match","agrs","arguments","each","s","String","m","RegExp","replace","n","Number","resize","$element","$modal","parents","wHeight","window","height","mHeight","offset","is","css","top","opacity","renderModal","options","extend","header","footer","modals","push","util","show","trigger","hide","close","maxHeight","overflow","wrap","join","before","after","on","setTimeout","find","scope","restrict","template","transclude","link","$scope","$watch","evtSuffix","evts","$on","attr","removeAttr","e","name","text","i","$emit"],"mappings":"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","file":"frame/component/modal/bs_modal.js","sourcesContent":["import app from 'angularAMD';\r\nimport modalLang from './frame/component/modal/lang/bs_modal';\r\nimport \"css!./frame/component/modal/less/index\";\r\n///import '$alert';\r\n\r\napp.directive('bsModal', ['$rootScope', function($rootScope) {\r\n\r\n    var lang = modalLang[$rootScope.lang?$rootScope.lang:\"cn\"];\r\n    // 动画时长，毫秒\r\n    var animateInterval = 300;\r\n    var DEFAULTS = {\r\n        mId: '', //  唯一的id\r\n        title: lang.promptTitle, // 标题\r\n        showHeader: true,\r\n        showFooter: true,\r\n        bodyHeight: undefined, //   主体高度\r\n        bodyMaxHeight: 600, //   模态框主体高度\r\n        modalSize: 'normal', //  模态框的尺寸\r\n        autoClose: true, // 是否自动关闭\r\n        showOk: true, //  显示确定按钮\r\n        showCancel: true, //  显示取消按钮\r\n        showClose: true, //  显示关闭按钮\r\n        okText: lang.promptBtnOkText,\r\n        cancelText: lang.promptBtnNoText,\r\n        okHandler: $.noop, // 确定按钮事件\r\n        cancelHandler: $.noop, //  取消按钮事件\r\n        beforeRender: null // 渲染之前的事件\r\n    };\r\n    /**\r\n     * 字符串模板替换\r\n     * @param tpl\r\n     * @returns {*|string}\r\n     *\r\n     * @example\r\n     *\r\n     * strfmt('my name is {1},i'm {2} years old','zhangsan',23);   my name is zhangsan,i'm 23 years old\r\n     */\r\n    function strfmt(tpl) {\r\n        tpl = tpl || '';\r\n        var vars = tpl.match(/\\{\\d+\\}/g) || [],\r\n            agrs = arguments;\r\n        $.each(vars, function() {\r\n            var s = String(this);\r\n            var m = new RegExp(s.replace(/{/g, '\\\\{').replace(/}/g, '\\\\}'), 'g');\r\n            var n = s.replace(/{|}/g, '');\r\n            tpl = tpl.replace(m, agrs[Number(n)] || '');\r\n        });\r\n        return tpl;\r\n    }\r\n\r\n    function resize($element) {\r\n        var $modal = $element.parents('.modal-content');\r\n        var wHeight = $(window).height();\r\n        var mHeight = $modal.height();\r\n        var offset = (wHeight - mHeight) / 2;\r\n        !$modal.is(':hidden') && $modal.css({ top: offset, opacity: 1 });\r\n    }\r\n\r\n    function renderModal(options, $element) {\r\n        options = $.extend(true, {}, DEFAULTS, options);\r\n        //==========开始创建模态框==========\r\n        var header = ['<div class=\"modal-header\">'],\r\n            footer = ['<div class=\"modal-footer\" style=\"text-align: center !important;\">'],\r\n            modals = [strfmt('<div style=\"display: none\" class=\"modal-content oasis-modal modal-{1}\"></div>', options.modalSize)];\r\n        header.push(\r\n            strfmt('<a class=\"close\" style=\"display: {1}\" role=\"button-cancel\">', options.showClose ? 'inline' : 'none'),\r\n            '<span>&times;</span>',\r\n            '</a>',\r\n            strfmt('<h4 class=\"modal-title\">{1}</h4>', options.title),\r\n            '</div>'\r\n        );\r\n        var util = {\r\n            show: function() {\r\n                $element.trigger('showmodal');\r\n            },\r\n            hide: function() {\r\n                $element.trigger('hidemodal');\r\n            },\r\n            close: $element.hide\r\n        };\r\n        options.showOk && footer.push('<button class=\"btn btn-sm btn-cus\" role=\"button-ok\">' + options.okText + '</button>');\r\n        options.showCancel && footer.push('<a class=\"btn btn-sm btn-cus\" role=\"button-cancel\">' + options.cancelText + '</a>');\r\n\r\n        options.bodyMaxHeight && $element.css({\r\n            maxHeight: options.bodyMaxHeight,\r\n            overflow: 'auto'\r\n        });\r\n\r\n        options.bodyHeight && $element.css({\r\n            height: options.bodyHeight,\r\n            overflow: 'auto'\r\n        });\r\n        //包裹容器\r\n        $element.wrap(modals.join(''));\r\n        //显示头部\r\n        options.showHeader && $element.before(header.join(''));\r\n        //显示尾部\r\n        options.showFooter && $element.after(footer.join(''));\r\n        options.beforeRender && options.beforeRender($element);\r\n\r\n        var $modal = $element.parents('.modal-content');\r\n        //打开关闭modal操作\r\n        $element.on('showmodal', function() {\r\n            if (!$modal.is(':hidden')) {\r\n                return;\r\n            }\r\n            $modal.show();\r\n            // 累计\r\n            $element.trigger('show.bs.modal');\r\n            $(window).trigger('resize');\r\n            setTimeout(function() {\r\n                $element.trigger('shown.bs.modal');\r\n            }, animateInterval);\r\n        }).on('hidemodal', function() {\r\n            if ($modal.is(':hidden')) {\r\n                return;\r\n            }\r\n            var wHeight = $(window).height();\r\n            var mHeight = $modal.height();\r\n            var offset = (wHeight - mHeight) / 2;\r\n            $element.trigger('hide.bs.modal');\r\n            $modal.css({\r\n                opacity: .3,\r\n                top: -offset\r\n            });\r\n            setTimeout(function() {\r\n                $modal.hide();\r\n                $element.trigger('hidden.bs.modal');\r\n            }, animateInterval);\r\n        });\r\n\r\n        //表头的x号\r\n        $modal.find('[role=\"button-cancel\"].close').on('click', function() {\r\n            $element.trigger('hidemodal');\r\n        });\r\n        //取消按钮事件\r\n        $modal.find('[role=\"button-cancel\"].btn').on('click', function() {\r\n            options.cancelHandler(util, $element);\r\n            $element.trigger('hidemodal');\r\n        });\r\n        //确定按钮的事件\r\n        $modal.find('[role=\"button-ok\"]').on('click', function() {\r\n            options.okHandler(util, $element);\r\n            options.autoClose && $element.trigger('hidemodal');\r\n        });\r\n\r\n        // 监听窗口变化事件\r\n        $(window).resize(function() {\r\n            resize($element);\r\n        });\r\n    }\r\n\r\n    return {\r\n        scope: {\r\n            options: \"=bsModal\"\r\n        },\r\n        restrict: 'EA',\r\n        template: '<div class=\"modal-body\" ng-transclude></div>',\r\n        replace: false,\r\n        transclude: true,\r\n        link: function($scope, $element) {\r\n            if (!($element instanceof $)) {\r\n                $element = $($element);\r\n            }\r\n            $scope.$watch('options', function(options) {\r\n                var evtSuffix = options && options.mId ? '#' + options.mId : '';\r\n                var evts = ['show.bs.modal', 'shown.bs.modal', 'hide.bs.modal', 'hidden.bs.modal'];\r\n                //========== 事件捕获处理 ==========\r\n                $scope.$on('show' + evtSuffix, function() {\r\n                    $element.trigger('showmodal');\r\n                });\r\n                $scope.$on('hide' + evtSuffix, function() {\r\n                    $element.trigger('hidemodal');\r\n                });\r\n                $scope.$on('disabled.ok' + evtSuffix, function() {\r\n                    $element.parents('.modal-content').find('[role=\"button-ok\"]').attr('disabled', 'disabled');\r\n                });\r\n                $scope.$on('disabled.cancel' + evtSuffix, function() {\r\n                    $element.parents('.modal-content').find('[role=\"button-cancel\"].btn').attr('disabled', 'disabled');\r\n                });\r\n                $scope.$on('enable.ok' + evtSuffix, function() {\r\n                    $element.parents('.modal-content').find('[role=\"button-ok\"]').removeAttr('disabled');\r\n                });\r\n                $scope.$on('enable.cancel' + evtSuffix, function() {\r\n                    $element.parents('.modal-content').find('[role=\"button-cancel\"].btn').removeAttr('disabled');\r\n                });\r\n                $scope.$on('change.title' + evtSuffix, function(e, name) {\r\n                    $element.parents('.modal-content').find('.modal-title').text(name);\r\n                });\r\n                //========== 事件动作处理 ==========\r\n                $.each(evts, function(i, e) {\r\n                    $element.on(e, function() {\r\n                        $scope.$emit(e + evtSuffix, $element);\r\n                    })\r\n                });\r\n                renderModal(options, $element);\r\n            });\r\n        }\r\n    };\r\n}]);\r\n"],"sourceRoot":"/source/"}