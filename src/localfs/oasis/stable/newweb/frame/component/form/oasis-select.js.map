{"version":3,"sources":["frame/component/form/oasis-select.js"],"names":["factory","$timeout","restrict","replace","scope","osModel","osDisabled","osLabel","osData","template","link","ele","attr","$input","$","$panel","hide","bind","show","position","css","top","parseFloat","left","trigger","osTrigger","id","Math","random","toString","substr","undefined","Error","search","osSearch","holder","placeholder","keyField","osKey","textField","osText","$watch","d","length","setValue","labelStyle","width","labelwidth","inputStyle","inputwidth","panelStyle","maxHeight","panelMaxHeight","name","item","text","off","on","e","preventDefault","stopPropagation","hideByOuter","find","target","is","document","directive"],"mappings":"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","file":"oasis-select.js","sourcesContent":["import app from 'angularAMD'\r\n// 导入样式\r\nimport 'css!frame/component/form/less/select'\r\n\r\nlet factory = ($timeout) => {\r\n    return {\r\n        restrict: 'E',\r\n        replace: true,\r\n        scope: {\r\n            osModel: '=',\r\n            osDisabled: '=',\r\n            osLabel: '@',\r\n            osData: '='\r\n        },\r\n        template: '<div class=\"oasis-select\" ng-class=\"{disabled:osDisabled}\">\\\r\n        <label ng-bind=\"osLabel\" for=\"{{id}}\" ng-style=\"labelStyle\" ng-show=\"!!osLabel\"></label>\\\r\n        <input role=\"input\" class=\"form-control\" id=\"{{id}}\" placeholder=\"{{holder}}\" type=\"text\" ng-model=\"text\" readonly ng-style=\"inputStyle\" ng-disabled=\"osDisabled\"/>\\\r\n        <div class=\"select-dropdown\" ng-style=\"inputStyle\">\\\r\n        <div class=\"search-box\" ng-show=\"search\"><input class=\"form-control\" ng-model=\"searchText\"></div>\\\r\n        <ul class=\"list-group\" ng-style=\"panelStyle\">\\\r\n        <li class=\"list-group-item\" ng-class=\"{active:(osModel===(keyField===\\'$all\\'?item:item[keyField]))}\" ng-repeat=\"item in osData | filter:searchText\" ng-click=\"setValue(keyField===\\'$all\\'?item:item[keyField],item[textField],item)\" ng-bind=\"item[textField]\"></li>\\\r\n        </ul>\\\r\n        </div>\\\r\n        </div>',\r\n        link(scope, ele, attr) {\r\n\r\n            let $input = $('[role=input]', ele);\r\n            let $panel = $('.select-dropdown', ele);\r\n            let hide = $panel.hide.bind($panel);\r\n            let show = function() {\r\n                let position = $input.position();\r\n                $panel.css({\r\n                    top: parseFloat(position.top) + 31 + 'px',\r\n                    left: position.left\r\n                }).show();\r\n            };\r\n\r\n            scope.trigger = attr.osTrigger || null;\r\n\r\n            scope.id = Math.random().toString(16).substr(2) + '_select';\r\n            if (attr.osModel === undefined) {\r\n                throw new Error('oasis-select应该有一个os-model属性');\r\n            }\r\n            scope.search = (attr.osSearch === undefined) ? true : (attr.osSearch === 'true');\r\n            scope.holder = attr.placeholder || '';\r\n            scope.keyField = attr.osKey || 'id';\r\n            scope.textField = attr.osText || 'name';\r\n\r\n            scope.$watch('osData', function(d) {\r\n                //  检查没有数据的时候讲选择的清空了\r\n                if (d && d.length === 1) {\r\n                    scope.setValue(d[0][scope.keyField], d[0][scope.textField]);\r\n                } else {\r\n                    scope.setValue('', '');\r\n                }\r\n            });\r\n\r\n            scope.labelStyle = {\r\n                width: attr.labelwidth ? attr.labelwidth + 'px' : '80px'\r\n            };\r\n\r\n            scope.inputStyle = {\r\n                width: attr.inputwidth ? attr.inputwidth + 'px' : '200px'\r\n            };\r\n\r\n            scope.panelStyle = {\r\n                maxHeight: attr.panelMaxHeight ? attr.panelMaxHeight + 'px' : '200px'\r\n            };\r\n\r\n            scope.setValue = function(id, name, item) {\r\n                scope.osModel = id;\r\n                scope.text = name;\r\n                hide();\r\n            };\r\n            if (scope.trigger) {\r\n                $timeout(() => {\r\n                    $(scope.trigger).off('click').on('click', (e) => {\r\n                        show();\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                    });\r\n                });\r\n            }\r\n\r\n            // 事件处理\r\n            $input.off('focus click').on('focus click', show);\r\n\r\n            function hideByOuter(e) {\r\n                if (!($(ele).find(e.target).length || $(ele).is(e.target))) {\r\n                    hide();\r\n                    e.stopPropagation();\r\n                }\r\n            }\r\n\r\n            $(document).off('click', hideByOuter).on('click', hideByOuter);\r\n\r\n        }\r\n    };\r\n};\r\n\r\napp.directive('oasisSelect', ['$timeout', factory]);"]}