{"version":3,"sources":["frame/component/ajax/ajax_valid.js"],"names":["define","$","app","directive","$http","DEFAULTS","url","method","params","live","validFn","resp","restrict","require","link","$scope","$ele","attr","c","tid","ajaxValid","validate","m","$viewValue","undefined","each","k","v","options","replace","request","post","JSON","stringify","get","param","success","data","result","$setValidity","i","error","extend","bind","$apply","$watch","ngModel","clearTimeout","setTimeout"],"mappings":"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","file":"frame/component/ajax/ajax_valid.js","sourcesContent":["define(['jquery', 'app'], function ($, app) {\n    app.directive('ajaxValid', ['$http', function ($http) {\n\n        var DEFAULTS = {\n            url: '',\n            method: 'post',// 请求方式\n            params: {},    //  额外参数\n            live: 2,  //  boolean/number  可以是数字。如果是数字就是几秒内执行一次\n            validFn: function (resp) {\n                return !!resp;\n            }\n        };\n\n        return {\n            restrict: 'A',\n            require: 'ngModel',\n            link: function ($scope, $ele, attr, c) {\n                $scope.tid = null;\n                if ($scope[attr.ajaxValid]) {\n                    var options = $.extend(true, {}, DEFAULTS, $scope[attr.ajaxValid]);\n                    // 缓存参数模板\n                    var params = options.params;\n                    var url = options.url;\n                    options.params = {};\n                    $ele.bind('blur', function () {\n                        $scope.$apply(function () {\n                            validate();\n                        });\n                    });\n\n                    function validate(m) {\n                        m = m || c.$viewValue;\n                        if(m==''||m===undefined){\n                            return;\n                        }\n                        $.each(params, function (k, v) {\n                            options.params[k] = v.replace('{value}', m);\n                        });\n                        options.url = url.replace('{value}', m);\n                        var request = {};\n                        if (options.method == 'post') {\n                            request = $http.post(options.url, JSON.stringify(options.params), {\"Content-Type\": \"application/json\",validate:true});\n                        } else if (options.method == 'get') {\n                            request = $http.get(options.url + '?' + $.param(options.params),{validate:true});\n                        }\n                        request.success(function (data) {\n                            var result = options.validFn(data);\n                            if (typeof result == 'boolean') {\n                                c.$setValidity('ajaxValid', result);\n                                if (result) {\n                                    for (var i = 0; i <= 10; i++) {\n                                        c.$setValidity('ajaxValid-' + i, true);\n                                    }\n                                }\n                            } else if (typeof result == 'number') {  // 如果是code码\n                                c.$setValidity('ajaxValid-' + result, false);\n                            }\n                        }).error(function (data) {\n                            c.$setValidity('ajaxValid', options.validFn(data));\n                        });\n                    }\n\n                    $scope.$watch(attr.ngModel, function (m) {\n                        var options = $.extend(true, {}, DEFAULTS, $scope[attr.ajaxValid]);\n                        if (typeof options.live == 'boolean') {\n                            options.live && validate(m);\n                        } else if (typeof options.live == 'number') {\n                            clearTimeout($scope.tid);\n                            $scope.tid = setTimeout(function () {\n                                validate(m);\n                            }, options.live * 1000);\n                        }\n                    });\n                }\n            }\n        };\n    }]);\n});"],"sourceRoot":"/source/"}